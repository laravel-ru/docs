# Конфигурация

- [Введение](#introduction)
- [Конфигурация среды](#environment-configuration)
    - [Типы переменных среды](#environment-variable-types)
    - [Получение конфигурации среды](#retrieving-environment-configuration)
    - [Определение текущей среды](#determining-the-current-environment)
    - [Скрытие переменных среды со страниц отладки](#hiding-environment-variables-from-debug)
- [Доступ к значениям конфигурации](#accessing-configuration-values)
- [Кэширование конфигурации](#configuration-caching)
- [Режим обслуживания](#maintenance-mode)

<a name="introduction"></a>
## Введение

Все файлы конфигурации для фреймворка Laravel хранятся в каталоге `config`. Каждый параметр задокументирован, поэтому не стесняйтесь просматривать файлы и знакомиться с доступными Вам вариантами.

<a name="environment-configuration"></a>
## Конфигурация среды

Часто бывает полезно иметь разные значения конфигурации в зависимости от среды, в которой выполняется приложение. Например, Вы можете захотеть использовать локально другой драйвер кеша, в отличии от использования на рабочем сервере.

Чтобы упростить это, Laravel использует библиотеку PHP [DotEnv](https://github.com/vlucas/phpdotenv) от Vance Lucas. В новой установке Laravel корневой каталог Вашего приложения будет содержать файл `.env.example`. Если Вы устанавливаете Laravel через Composer, этот файл будет автоматически скопирован в `.env`. В остальных случаях Вам следует скопировать файл вручную.

Ваш файл `.env` не должен быть привязан к системе контроля версий Вашего приложения, поскольку каждому разработчику / серверу, использующему Ваше приложение, может потребоваться другая конфигурация среды. Более того, это будет угрозой безопасности в случае, если злоумышленник получит доступ к Вашему репозиторию системы управления версиями, поскольку любые конфиденциальные учетные данные будут раскрыты.

Если Вы работаете в команде, Вы можете продолжить включение файла `.env.example` в свое приложение. Помещая значения заполнителей в пример файла конфигурации, другие разработчики в Вашей команде могут четко видеть, какие переменные среды необходимы для запуска Вашего приложения. Вы также можете создать файл `.env.testing`. Он переопределит файл `.env` при запуске тестов PHPUnit или выполнении Artisan-команд с параметром `--env=testing`.

> {tip} Любая переменная в Вашем файле `.env` может быть переопределена внешними переменными среды, такими как переменные среды уровня сервера или системы.

<a name="environment-variable-types"></a>
### Типы переменных среды

Все переменные в Ваших файлах `.env` анализируются как строки, поэтому были созданы некоторые зарезервированные значения, позволяющие Вам возвращать более широкий диапазон типов из функции `env()`:

`.env` Значение  | `env()` Значение
------------- | -------------
true | (bool) true
(true) | (bool) true
false | (bool) false
(false) | (bool) false
empty | (string) ''
(empty) | (string) ''
null | (null) null
(null) | (null) null

Если Вам нужно определить переменную среды со значением, содержащим пробелы, Вы можете сделать это, заключив значение в двойные кавычки.

    APP_NAME="My Application"

<a name="retrieving-environment-configuration"></a>
### Получение конфигурации среды

Все переменные, перечисленные в этом файле, будут загружены в суперглобал PHP `$_ENV`, когда Ваше приложение получит запрос. Однако Вы можете использовать помощник `env` для получения значений из этих переменных в Ваших файлах конфигурации. Фактически, если Вы просмотрите файлы конфигурации Laravel, Вы заметите несколько опций, уже использующих этот помощник:

    'debug' => env('APP_DEBUG', false),

Второе значение, переданное в функцию `env`, - это «значение по умолчанию». Это значение будет использоваться, если для данного ключа не существует переменной среды.

<a name="determining-the-current-environment"></a>
### Определение текущей среды

Текущая среда приложения определяется с помощью переменной `APP_ENV` из Вашего файла `.env`. Вы можете получить доступ к этому значению с помощью метода `environment` в `App` [facade](/docs/{{version}}/facades):

    $environment = App::environment();

Вы также можете передать аргументы методу `environment`, чтобы проверить, соответствует ли среда заданному значению. Метод вернет `true`, если среда соответствует любому из заданных значений:

    if (App::environment('local')) {
        // Среда является локальной
    }

    if (App::environment(['local', 'staging'])) {
        // Среда является локальной ИЛИ промежуточной...
    }

> {tip} Текущее определение среды приложения может быть переопределено переменной среды уровня сервера `APP_ENV`. Это может быть полезно, когда Вам нужно совместно использовать одно и то же приложение для разных конфигураций среды, поэтому Вы можете настроить данный хост в соответствии с данной средой в конфигурациях Вашего сервера.

<a name="hiding-environment-variables-from-debug"></a>
### Скрытие переменных среды со страниц отладки

Когда исключение не перехвачено и переменная среды `APP_DEBUG` имеет значение `true`, на странице отладки будут показаны все переменные среды и их содержимое. В некоторых случаях Вы можете захотеть скрыть определенные переменные. Вы можете сделать это, обновив параметр `debug_hide` в файле конфигурации `config/app.php`.

Некоторые переменные доступны как в переменных среды, так и в данных сервера / запроса. Следовательно, Вам может потребоваться скрыть их как для `$_ENV`, так и для `$_SERVER`:

    return [

        // ...

        'debug_hide' => [
            '_ENV' => [
                'APP_KEY',
                'DB_PASSWORD',
            ],

            '_SERVER' => [
                'APP_KEY',
                'DB_PASSWORD',
            ],

            '_POST' => [
                'password',
            ],
        ],
    ];

<a name="accessing-configuration-values"></a>
## Доступ к значениям конфигурации

Вы можете легко получить доступ к своим значениям конфигурации, используя глобальную вспомогательную функцию `config` из любого места Вашего приложения. Доступ к значениям конфигурации можно получить с помощью синтаксиса «точка», который включает имя файла и параметр, к которому Вы хотите получить доступ. Также может быть указано значение по умолчанию, которое будет возвращено, если параметр конфигурации не существует:

    $value = config('app.timezone');

    // Получить значение по умолчанию, если значение конфигурации не существует ...
    $value = config('app.timezone', 'Asia/Seoul');

Чтобы установить значения конфигурации во время выполнения, передайте массив помощнику `config`:

    config(['app.timezone' => 'America/Chicago']);

<a name="configuration-caching"></a>
## Кэширование конфигурации

Чтобы ускорить работу Вашего приложения, Вы должны кэшировать все файлы конфигурации в один файл с помощью Artisan-команды `config:cache`. Это объединит все параметры конфигурации Вашего приложения в один файл, который будет быстро загружен фреймворком.

Обычно Вы должны запускать команду `php artisan config:cache` как часть процедуры развертывания в производственной среде. Команду не следует запускать во время локальной разработки, поскольку параметры конфигурации часто нужно будет изменять в ходе разработки Вашего приложения.

> {note} Если Вы выполняете команду `config:cache` в процессе развертывания, Вы должны быть уверены, что вызываете функцию `env` только из Ваших файлов конфигурации. После кэширования конфигурации файл `.env` не будет загружен, и все вызовы функции `env` вернут `null`.

<a name="maintenance-mode"></a>
## Режим обслуживания

Когда Ваше приложение находится в режиме обслуживания, для всех запросов к Вашему приложению будет отображаться настраиваемое представление. Это позволяет легко «отключить» Ваше приложение во время его обновления или во время обслуживания. Проверка режима обслуживания включена в стек промежуточного программного обеспечения по умолчанию для Вашего приложения. Если приложение находится в режиме обслуживания, будет выброшено исключение `MaintenanceModeException` с кодом состояния 503.

Чтобы включить режим обслуживания, выполните Artisan-команду `down`:

    php artisan down

Вы также можете предоставить опцию `retry` команде `down` которая будет установлена как значение HTTP-заголовка `Retry-After`:

    php artisan down --retry=60

<a name="bypassing-maintenance-mode"></a>
#### Обход режима обслуживания

Даже находясь в режиме обслуживания, Вы можете использовать опцию `secret`, чтобы указать токен обхода режима обслуживания:

    php artisan down --secret="1630542a-246b-4b66-afa1-dd72a4c43515"

После перевода приложения в режим обслуживания Вы можете перейти к URL-адресу приложения, соответствующему этому токену, и Laravel выдаст Вашему браузеру файл куки обхода режима обслуживания:

    https://example.com/1630542a-246b-4b66-afa1-dd72a4c43515

При доступе к этому скрытому маршруту Вы будете перенаправлены на маршрут `/` приложения. Как только куки будет отправлен Вашему браузеру, Вы сможете просматривать приложение в обычном режиме, как если бы оно не находилось в режиме обслуживания.

<a name="pre-rendering-the-maintenance-mode-view"></a>
#### Предварительная визуализация представления режима обслуживания

Если Вы используете команду `php artisan down` во время развертывания, Ваши пользователи могут иногда сталкиваться с ошибками, если они обращаются к приложению во время обновления Ваших зависимостей Composer или других компонентов инфраструктуры. Это происходит потому, что значительная часть инфраструктуры Laravel должна загружаться, чтобы определить, находится ли Ваше приложение в режиме обслуживания, и отобразить представление режима обслуживания с помощью механизма шаблонов.

По этой причине Laravel позволяет предварительно отобразить представление режима обслуживания, которое будет возвращено в самом начале цикла запроса. Это представление отображается перед загрузкой любой из зависимостей Вашего приложения. Вы можете выполнить предварительный рендеринг шаблона по Вашему выбору, используя параметр `render` команды `down`:

    php artisan down --render="errors::503"

<a name="redirecting-maintenance-mode-requests"></a>
#### Перенаправление запросов режима обслуживания

В режиме обслуживания Laravel будет отображать представление режима обслуживания для всех URL-адресов приложений, к которым пользователь пытается получить доступ. Если хотите, Вы можете указать Laravel перенаправлять все запросы на определенный URL. Это может быть выполнено с помощью опции `redirect`. Например, Вы можете перенаправить все запросы на URI `/`:

    php artisan down --redirect=/

<a name="disabling-maintenance-mode"></a>
#### Отключение режима обслуживания

Чтобы отключить режим обслуживания, используйте команду `up`:

    php artisan up

> {tip} Вы можете настроить шаблон режима обслуживания по умолчанию, определив свой собственный шаблон в `resources/views/errors/503.blade.php`.

<a name="maintenance-mode-queues"></a>
#### Режим обслуживания и очереди

Пока Ваше приложение находится в режиме обслуживания, никакие [поставленные в очередь задания](/docs/{{version}}/queues) обрабатываться не будут. Задания продолжат обрабатываться в обычном режиме после выхода приложения из режима обслуживания.

<a name="alternatives-to-maintenance-mode"></a>
#### Альтернативы режиму обслуживания

Поскольку режим обслуживания требует, чтобы Ваше приложение простаивало несколько секунд, рассмотрите альтернативы, такие как [Envoyer](https://envoyer.io), чтобы выполнить развертывание с нулевым временем простоя с Laravel.
